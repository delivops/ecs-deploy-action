# Example: Combined SQS + Time autoscaling (full configuration)
name: queue-worker
replica_count: 4
cpu: 512
memory: 1024
role_arn: arn:aws:iam::123456789012:role/ecsTaskExecutionRole
port: 8080

envs:
  - APP_ENV: production
  - QUEUE_WORKER: "true"

secrets_envs:
  - name: app-secrets

autoscaling_configs:
  # Combined provider: SQS for reactive scaling + time for scheduled capacity
  provider:
    type: sqs+time
    
    sqs:
      queue_url: https://sqs.us-east-1.amazonaws.com/123456789012/production-queue
    
    time:
      timezone: America/New_York
      mode: floor
      rules:
        # Business hours (Monday-Friday 9am-6pm EST)
        - days: [mon, tue, wed, thu, fri]
          start: "09:00"
          end: "18:00"
          min_desired: 4
        
        # Weekend - reduced capacity
        - days: [sat, sun]
          min_desired: 1
  
  # Global scaling parameters
  min_tasks: 2
  max_tasks: 200
  target_max_message_age_seconds: 120
  scale_out_cooldown_seconds: 90
  scale_in_cooldown_seconds: 600
  max_scale_out_percent: 25
  max_scale_in_tasks: 1
  
  # Scale-in guard: only scale in when queue is truly empty
  scale_in_guard:
    mode: empty_queue

